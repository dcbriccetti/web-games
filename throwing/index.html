<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Throwing a Ball</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 1em;
        }
    </style>
</head>
<body>

<h1>Throwing a Ball</h1>
<p>When you press the space bar, this program “throws a ball” and destroys
    the enemy. Reload the page afterward to start again.</p>

<script type="text/javascript">

var game = new Phaser.Game(800, 800, Phaser.AUTO, '', {
    preload: preload, create: create, update: update
});

function preload() {
    game.load.image('Player', 'assets/player.png');
    game.load.image('Ball',   'assets/ball.png');
    game.load.image('Enemy',  'assets/enemy.png');
}

var player;
var enemy;
var ball;
var cursors;
var running = true;

function create() {
    game.stage.backgroundColor = 'd0d0d0';
    game.physics.startSystem(Phaser.Physics.P2JS);

    player = game.add.sprite(150, game.world.height / 2, 'Player');
    enemy  = game.add.sprite(700, game.world.height / 2, 'Enemy');
    game.physics.p2.enable(player);
    game.physics.p2.enable(enemy);

    cursors = game.input.keyboard.createCursorKeys();
    var throwKey = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    throwKey.onDown.add(throwBall, this);
}

function throwBall() {
    var x = Math.cos(player.body.rotation);
    var y = Math.sin(player.body.rotation);
    ball = game.add.sprite(player.x + x * player.width / 2, 
        player.y + y * player.height / 2, 'Ball');
    game.physics.p2.enable(ball);
    ball.body.onBeginContact.add(spriteContact, this);
    ball.body.moveRight(x * 500);
    ball.body.moveUp(-y * 500);
}

function update() {
    var moveAmt = 200;
    player.body.setZeroVelocity();
    player.body.setZeroRotation();

    if (running) {
        if (cursors.left.isDown) {
            player.body.angle -= 5;
        }
        if (cursors.right.isDown) {
            player.body.angle += 5;
        }
        if (cursors.up.isDown) {
            player.body.moveUp(moveAmt);
        }
        if (cursors.down.isDown) {
            player.body.moveDown(moveAmt);
        }
    }
}

function spriteContact(body, shapeA, shapeB, equation) {
    if (body.sprite !== player) {
        body.sprite.kill();
        ball.kill();
    }
}

</script>

</body>
</html>