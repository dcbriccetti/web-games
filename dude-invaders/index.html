<!doctype html> 
<html lang="en"> 
    <head> 
        <meta charset="UTF-8" />
        <title>Dude Invaders</title>
        <script type="text/javascript" src="js/phaser.min.js"></script>
    </head>
    <body>

        <h3>Dude Invaders</h3>

        <script type="text/javascript">

            var whacker;
            var cursors;
            var trash;

            var game = new Phaser.Game(800, 500, Phaser.AUTO, '', {
                preload: preload, create: create, update: update
            });

            function preload() {
                game.load.spritesheet('dude', 'assets/DudeSpriteSheet.png', 68, 96);
                game.load.image('dozer', 'assets/dozer2.png');
                game.load.image('trash', 'assets/trash.png');
            }

            function create() {
                game.stage.backgroundColor = '303030';
                game.physics.startSystem(Phaser.Physics.P2JS);

                for (var n = 0; n < 20; ++n) {
                    var x = game.rnd.integerInRange(20, game.world.width  - 40);
                    var y = game.rnd.integerInRange(20, game.world.height - 40);
                    var dude = game.add.sprite(x, y, 'dude');
                    game.physics.p2.enable(dude);
                    dude.animations.add('blow', [0, 1]);
                    dude.animations.play('blow', 4, true);
                }
                
                trash = game.add.sprite(game.world.width - 50, game.world.height - 50, 'trash');
                trash.anchor.setTo(.5);
                game.physics.p2.enable(trash);
                trash.body.static = true;
                trash.body.onBeginContact.add(function(body, shapeA, shapeB, equation) {
                    if (body.sprite !== whacker)
                        body.sprite.kill();
                });

                whacker = game.add.sprite(game.world.width / 2, game.world.height - 250, 'dozer');
                game.physics.p2.enable(whacker);
                whacker.body.mass = 1000;

                cursors = game.input.keyboard.createCursorKeys();
                var throwKey = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
                throwKey.onDown.add(spin, this);
            }

            function update() {
                var moveAmt = 200;
                whacker.body.setZeroVelocity();

                if (cursors.left.isDown) {
                    whacker.body.moveLeft(moveAmt);
                }
                if (cursors.right.isDown) {
                    whacker.body.moveRight(moveAmt);
                }
                if (cursors.up.isDown) {
                    whacker.body.moveUp(moveAmt);
                }
                if (cursors.down.isDown) {
                    whacker.body.moveDown(moveAmt);
                }
            }
            
            function spin() {
                whacker.body.angularVelocity = 10;
            }

        </script>

    </body>
</html>