<!doctype html> 
<html lang="en"> 
    <head> 
        <meta charset="UTF-8" />
        <title>Dude Invaders</title>
        <script type="text/javascript" src="js/phaser.min.js"></script>
    </head>
    <body>

        <h3>Dude Invaders</h3>

        <script type="text/javascript">

            var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {
                preload: preload, create: create, update: update
            });

            function preload() {
                game.load.image('dude',  'assets/dude.png');
                game.load.image('dozer', 'assets/dozer.png');
                game.load.image('trash', 'assets/trash.png');
            }

            var dozer;
            var cursors;
            var trash;

            function create() {
                game.stage.backgroundColor = '303030';
                game.physics.startSystem(Phaser.Physics.P2JS);

                for (var n = 0; n < 40; ++n) {
                    var x = this.rnd.integerInRange(20, game.world.width  - 40);
                    var y = this.rnd.integerInRange(20, game.world.height - 40);
                    var dude = game.add.sprite(x, y, 'dude');
                    game.physics.p2.enable(dude);
                }
                
                trash = game.add.sprite(game.world.width - 50, game.world.height - 50, 'trash');
                trash.anchor.setTo(.5);
                game.physics.p2.enable(trash);
                trash.body.static = true;
                trash.body.onBeginContact.add(function(body, shapeA, shapeB, equation) {
                    if (body.sprite !== dozer)
                        body.sprite.kill();
                });

                dozer = game.add.sprite(game.world.width / 2, game.world.height - 250, 'dozer');
                dozer.anchor.setTo(.5);
                game.physics.p2.enable(dozer);
                dozer.body.fixedRotation = true;

                cursors = game.input.keyboard.createCursorKeys();
            }

            function update() {
                var moveAmt = 200;
                dozer.body.setZeroVelocity();

                if (cursors.left.isDown) {
                    dozer.body.moveLeft(moveAmt);
                }
                if (cursors.right.isDown) {
                    dozer.body.moveRight(moveAmt);
                }
                if (cursors.up.isDown) {
                    dozer.body.moveUp(moveAmt);
                }
                if (cursors.down.isDown) {
                    dozer.body.moveDown(moveAmt);
                }
            }

        </script>

    </body>
</html>